<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Losowe nuty z ograniczeniami</title>
  <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.2/build/cjs/vexflow.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      color: black; /* Zmieniony kolor tekstu na czarny */
    }
    #music {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      padding: 20px;
      border-radius: 8px;
    }
    button {
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
    }
    button:hover {
      background-color: #2980b9; /* Efekt po najechaniu na przycisk */
    }
    .slider-container {
      margin: 20px;
    }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      padding: 0 20px;
    }
  </style>
</head>
<body>
  <h1>Losowe nuty z ograniczeniami</h1>
  <div class="slider-container">
    <label for="noteCount">Liczba nut na raz: </label>
    <input type="range" id="noteCount" min="1" max="3" value="1" step="1">
    <span id="noteCountValue">1</span>
    <div class="slider-labels">
      <span>1 nuta</span>
      <span>2 nuty</span>
      <span>3 nuty</span>
    </div>
  </div>
  <div id="music"></div>
  <button id="generate">Generuj nowe nuty</button>

  <script>
    const VF = Vex.Flow;

    // Lista możliwych tonacji (bez tonacji molowych)
    const keys = [
      'C', 'G', 'D', 'A', 'E', 'B', 'F#', 'Db', 'Ab', 'Eb', 'Bb', 'F'
    ];

    // Losowanie tonacji
    function getRandomKey() {
      return keys[Math.floor(Math.random() * keys.length)];
    }

    // Losowanie nuty w zakresie z chromatycznymi
    function getRandomNoteInRange(lowerNote, upperNote) {
      const notes = ['c', 'd', 'e', 'f', 'g', 'a', 'b'];
      const accidentals = ['', '#', 'b']; // Usunięto 'n', aby wyeliminować problem z przypadkowym kasowaniem
      const lowerOctave = parseInt(lowerNote.split('/')[1]);
      const upperOctave = parseInt(upperNote.split('/')[1]);

      const randomOctave = Math.floor(Math.random() * (upperOctave - lowerOctave + 1)) + lowerOctave;
      const availableNotes =
        randomOctave === lowerOctave
          ? notes.slice(notes.indexOf(lowerNote[0]))
          : randomOctave === upperOctave
          ? notes.slice(0, notes.indexOf(upperNote[0]) + 1)
          : notes;

      const randomNote = availableNotes[Math.floor(Math.random() * availableNotes.length)];

      // Losowanie znaku chromatycznego z opcją 0 (brak) lub jeden z trzech znaków
      const accidental = accidentals[Math.floor(Math.random() * accidentals.length)];

      return `${randomNote}${accidental}/${randomOctave}`;
    }

    // Funkcja do rysowania pięciolinii
    function drawStaff() {
      const div = document.getElementById("music");
      div.innerHTML = ""; // Wyczyść poprzedni rysunek

      const renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);
      renderer.resize(600, 300); // Rozmiar obszaru rysowania
      const context = renderer.getContext();

      // Losowanie tonacji
      const keySignature = getRandomKey();

      // Tylko jeden takt z kluczem i tonacją
      const staveTreble = new VF.Stave(10, 40, 500);  
      staveTreble.addClef("treble").addKeySignature(keySignature).setContext(context).draw();

      const staveBass = new VF.Stave(10, 140, 500);  
      staveBass.addClef("bass").addKeySignature(keySignature).setContext(context).draw();

      const noteCount = parseInt(document.getElementById('noteCount').value); // Pobranie wartości z suwaka

      // Losowanie kilku nut w jednym czasie dla wiolinowej
      const notesTreble = Array(4).fill(null).map(() => {
        const numNotes = Math.floor(Math.random() * noteCount) + 1;  // Losowanie liczby nut (1-2 lub 1-3)
        const notes = [];
        for (let i = 0; i < numNotes; i++) {
          notes.push(getRandomNoteInRange('a/3', 'c/6')); // Losowanie nut w określonym zakresie
        }
        return new VF.StaveNote({
          keys: notes,
          duration: "q",
        });
      });

      // Losowanie kilku nut w jednym czasie dla basowej
      const notesBass = Array(4).fill(null).map(() => {
        const numNotes = Math.floor(Math.random() * noteCount) + 1;  // Losowanie liczby nut (1-2 lub 1-3)
        const notes = [];
        for (let i = 0; i < numNotes; i++) {
          notes.push(getRandomNoteInRange('a/3', 'c/6')); // Losowanie nut w określonym zakresie
        }
        return new VF.StaveNote({
          keys: notes,
          duration: "q",
        });
      });

      const voiceTreble = new VF.Voice({ num_beats: 4, beat_value: 4 });
      const voiceBass = new VF.Voice({ num_beats: 4, beat_value: 4 });

      voiceTreble.addTickables(notesTreble);
      voiceBass.addTickables(notesBass);

      new VF.Formatter().joinVoices([voiceTreble]).format([voiceTreble], 400);
      new VF.Formatter().joinVoices([voiceBass]).format([voiceBass], 400);

      voiceTreble.draw(context, staveTreble);
      voiceBass.draw(context, staveBass);
    }

    // Funkcja generująca nowe nuty
    document.getElementById("generate").addEventListener("click", drawStaff);
    document.getElementById("noteCount").addEventListener("input", function() {
      document.getElementById("noteCountValue").textContent = this.value;
    });

    // Początkowe generowanie nut
    drawStaff();
  </script>
</body>
</html>
